<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sp√∂krundan ‚Äì Halloweenquiz</title>
  <meta name="theme-color" content="#0b0b12" />
  <style>
    :root{
      --bg:#0b0b12;          /* natt-svart */
      --card:#141421;        /* m√∂rk lila/svart */
      --accent:#ff6a00;      /* pumpa-orange */
      --accent-2:#ffb703;    /* ljusare orange */
      --ok:#3ddc84;          /* gr√∂n succ√© */
      --err:#ff375f;         /* sp√∂kr√∂d */
      --ink:#f5f7ff;         /* ljus text */
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background: radial-gradient(1200px 600px at 20% 0%, #1a1a29 0%, var(--bg) 60%),
                 linear-gradient(180deg, #0b0b12 0%, #07070c 100%);
      color:var(--ink);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
      overflow-x:hidden;
    }

    /* Flygande fladderm√∂ss */
    .bat{position:fixed; top:10vh; width:42px; height:20px; background:transparent; z-index:0; opacity:.15;}
    .bat:before,.bat:after{content:""; position:absolute; inset:0; background: radial-gradient(circle at 30% 50%, #000 0 40%, transparent 41%),
                                             radial-gradient(circle at 70% 50%, #000 0 40%, transparent 41%);
      transform-origin:center; animation: flap 700ms infinite ease-in-out;}
    .bat:after{transform: scaleX(-1);}
    @keyframes flap{ 0%,100%{transform: rotate(8deg)} 50%{transform: rotate(-8deg)} }
    @keyframes drift{ 0%{ transform: translateX(-10vw) translateY(0)} 100%{ transform: translateX(110vw) translateY(2vh)} }

    .bat.b1{ top:12vh; animation: drift 24s linear infinite; }
    .bat.b2{ top:22vh; animation: drift 28s linear infinite reverse; }
    .bat.b3{ top:6vh;  animation: drift 32s linear infinite; }

    .wrap{min-height:100%; display:grid; place-items:center; padding:24px; position:relative;}

    .card{
      width:min(760px, 92vw);
      background: linear-gradient(180deg, #17172a 0%, #11111c 100%);
      border:1px solid rgba(255,255,255,.06);
      border-radius:24px; padding:24px; box-shadow: 0 30px 80px rgba(0,0,0,.45);
      position:relative; z-index:1;
    }

    .titleRow{display:flex; align-items:center; gap:12px;}
    .pumpkin{font-size:28px}

    h1{font-size: clamp(22px, 4vw, 34px); margin:8px 0 4px; letter-spacing:.5px}
    p.lead{margin:0; opacity:.9}

    .progress{display:flex; align-items:center; gap:8px; margin-top:12px;}
    .bar{flex:1; height:10px; background:#1c1c2e; border-radius:999px; overflow:hidden}
    .bar>span{display:block; height:100%; width:0; background:linear-gradient(90deg, var(--accent), var(--accent-2));}
    .count{font-weight:600; letter-spacing:.3px}

    .qa{margin-top:18px; display:grid; gap:14px}
    .q{font-size: clamp(18px, 3.2vw, 22px); font-weight:600}

    .field{display:flex; gap:10px;}
    input[type="text"]{
      flex:1; font-size:18px; padding:14px 16px; border-radius:14px; border:1px solid #2a2a42;
      background:#0f0f1a; color:var(--ink); outline:none; transition: box-shadow .2s, border-color .2s;
    }
    input[type="text"]:focus{ box-shadow:0 0 0 4px rgba(255,106,0,.15); border-color:#3a3a58 }

    button{
      font-size:18px; font-weight:700; letter-spacing:.3px; padding:14px 18px; border-radius:14px; border:none; cursor:pointer;
      background:linear-gradient(180deg, var(--accent) 0%, #e45a00 100%); color:#1a0c00; text-shadow:0 1px 0 rgba(255,255,255,.2);
      box-shadow:0 12px 28px rgba(255,106,0,.25), inset 0 -2px 0 rgba(0,0,0,.2);
      transition: transform .05s ease, filter .2s ease; flex-shrink:0;
    }
    button:active{ transform: translateY(1px) }

    .hint{opacity:.9; font-size:14px}

    .toast{ position:fixed; left:50%; bottom:24px; transform:translateX(-50%) translateY(40px); background:#17172a; color:var(--ink);
      border:1px solid rgba(255,255,255,.08); padding:12px 16px; border-radius:12px; box-shadow:0 10px 30px rgba(0,0,0,.4);
      opacity:0; transition: transform .25s ease, opacity .25s ease; z-index:3;}
    .toast.show{ opacity:1; transform:translateX(-50%) translateY(0)}

    /* Modal f√∂r fel svar */
    .modal{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:4; }
    .modal[aria-hidden="false"]{ display:flex; }
    .backdrop{ position:absolute; inset:0; backdrop-filter: blur(3px); background:rgba(5,5,10,.65); }
    .dialog{ position:relative; background:#19192b; border:1px solid rgba(255,255,255,.1); border-radius:20px; width:min(560px, 92vw);
             padding:20px; box-shadow: 0 40px 120px rgba(0,0,0,.6); }
    .dialog h2{ margin:0 0 10px; font-size:22px }
    .dialog p{ margin:0 0 14px; opacity:.95 }
    .dialog .actions{ display:flex; justify-content:flex-end; gap:10px; }
    .ghostBtn{ background:#25253a; color:var(--ink); border:1px solid #333355; box-shadow:none; }

    /* Gr√∂nt sken vid r√§tt svar */
    .card.correct{ box-shadow: 0 0 0 2px rgba(61,220,132,.3), 0 30px 80px rgba(0,0,0,.45); }

    /* Reset-knapp (l√•ngtryck) */
    .reset{
      position: fixed; right: 12px; bottom: 12px; z-index: 2;
      background:#222238; color:#c0c2ff; border:1px dashed #3a3a5a; box-shadow:none; opacity:.7; font-weight:600;
    }
    .reset:active{ transform:none }

    /* Slutsk√§rm */
    .finish{ text-align:center; display:grid; gap:10px; }
    .finish h2{ font-size: clamp(22px, 4.5vw, 32px); margin:8px 0 }
    .finish p{ opacity:.95 }

    /* SCARE MODE (slutsk√§rm) */
    body.scare{ background: radial-gradient(1200px 800px at 50% -10%, #2a0006 0%, #0a0003 55%), linear-gradient(180deg, #09000e 0%, #050006 100%); }
    body.scare .bat{ display:none; }
    body.scare .titleRow, body.scare .progress{ display:none; }
    body.scare .card{ width:min(840px,94vw); background: linear-gradient(180deg, #12000a 0%, #0b0006 100%); border-color: rgba(255,0,0,.08); box-shadow: 0 40px 140px rgba(0,0,0,.7), inset 0 0 60px rgba(255,0,0,.05); }
    .codeBig{ font-size: clamp(64px, 14vw, 160px); font-weight:900; letter-spacing:.08em; text-align:center; line-height:1; color:#ff2e2e;
      text-shadow: 0 0 24px rgba(255,0,0,.25), 0 6px 0 rgba(0,0,0,.5); animation: throb 2.2s ease-in-out infinite; user-select: all; }
    @keyframes throb{ 0%,100%{ filter: drop-shadow(0 0 0 rgba(255,0,0,0)); transform: translateY(0)} 50%{ filter: drop-shadow(0 0 18px rgba(255,0,0,.5)); transform: translateY(-2px)} }
    .codeSub{ text-align:center; opacity:.9; margin-top:8px; font-size: clamp(12px, 2.5vw, 16px); letter-spacing:.04em; }
    body.scare .reset{ opacity:.4 }

    /* Stora touchytor p√• iPad */
    @media (pointer:coarse){ button{ padding:16px 20px; } }
  </style>
</head>
<body>
  <!-- Fladderm√∂ss -->
  <div class="bat b1" aria-hidden="true"></div>
  <div class="bat b2" aria-hidden="true"></div>
  <div class="bat b3" aria-hidden="true"></div>

  <div class="wrap">
    <main class="card" id="card" aria-live="polite">
      <div class="titleRow">
        <span class="pumpkin" aria-hidden="true">üéÉ</span>
        <div>
          <h1>Sp√∂krundan ‚Äì L√•s upp n√§sta g√•ta</h1>
          <p class="lead">Svara r√§tt f√∂r att komma vidare. Fel svar ger en kuslig ledtr√•d‚Ä¶ üëª</p>
        </div>
      </div>

      <div class="progress" aria-label="Framsteg">
        <div class="bar" aria-hidden="true"><span id="barFill"></span></div>
        <div class="count" id="count">G√•ta 1 / 1</div>
      </div>

      <section class="qa" id="qa">
        <!-- Inneh√•ll renderas av JS -->
      </section>
    </main>
  </div>

  <button class="reset ghostBtn" id="resetBtn" title="H√•ll inne i 2 sek f√∂r att b√∂rja om">√Öterst√§ll</button>

  <!-- Modal -->
  <div class="modal" id="modal" aria-hidden="true" role="dialog" aria-modal="true" aria-labelledby="m-title">
    <div class="backdrop" id="backdrop"></div>
    <div class="dialog">
      <h2 id="m-title">Fel svar! üò±</h2>
      <p id="m-body">F√∂rs√∂k igen.</p>
      <div class="actions">
        <button class="ghostBtn" id="closeModal">Okej</button>
      </div>
    </div>
  </div>

  <div class="toast" id="toast" role="status" aria-live="polite"></div>

  <script>
    /********************
     *  ENKEL KONFIG     *
     ********************/
    // √Ñndra fr√•gorna h√§r. Svar kan vara en str√§ng ELLER en array av str√§ngar.
    const QUESTIONS = [
      {
        q: "N√§r dog Dracula enligt legenden?",
        answer: ["1476", "1 4 7 6"],
        hint: "boken om Dracula kanske har svaret"
      },
      {
        q: "I garaget finns en bild p√• pojken som f√∂rsvann. N√§r √§r bilden m√•lad?",
        answer: ["1632", "1 6 3 2"],
        hint: "Titta ordentligt. Han finns d√§r n√•gonstans."
      },
      {
        q: "Ibland √§r det l√§skigt bakom hus. Speciellt det stora vita. Men d√§r finns svaret",
        answer: "skugga",
        hint: "det finns alltid d√§r ljuset stoppas"
      },
      {
        q: "I k√§llaren bor inga monster. Men d√§r bor n√•gon. Ta det f√∂rsiktigt",
        answer: ["m√•laren", "M√ÖLAREN"],
        hint: "den som ger f√§rg √•t tillvaron."
      },
      {
        q: "I maskinhallen ska man absolut ta det f√∂rsiktigt. Vad st√•r det egentligen p√• d√∂rren?",
        answer: ["galning", "GALNING"],
        hint: "N√•gon som √§r helt vild"
      }
    ];
    const ENTRY_CODE = "111019"; // <- Sexsiffrig startkod (√§ndra h√§r)
    const KEY_GATE = "spok_runda_gate_v1"; // lokal lagring f√∂r uppl√•st start

    // Text p√• knappen
    const SUBMIT_LABEL = "L√•s upp n√§sta g√•ta";

    // Lokal lagring
    const KEY_PROGRESS = "spok_runda_progress_v1";

    /********************
     *  HJ√ÑLPFUNKTIONER  *
     ********************/
    const qs = s => document.querySelector(s);
    const card = qs('#card');
    const qa = qs('#qa');
    const barFill = qs('#barFill');
    const count = qs('#count');
    const toast = qs('#toast');

    function norm(s){
      return (s||"")
        .toString()
        .trim()
        .toLowerCase()
        .replaceAll(" ","")
        .replace(/\s+/g,"");
    }

    function saveProgress(i){ localStorage.setItem(KEY_PROGRESS, String(i)); }
    function loadProgress(){ return Number(localStorage.getItem(KEY_PROGRESS) || 0); }
    function resetProgress(){ localStorage.removeItem(KEY_PROGRESS); localStorage.removeItem(KEY_GATE); }

    function showToast(msg){
      toast.textContent = msg; toast.classList.add('show');
      setTimeout(()=> toast.classList.remove('show'), 1800);
    }

    // Modal
    const modal = qs('#modal');
    const closeModalBtn = qs('#closeModal');
    const backdrop = qs('#backdrop');
    const modalBody = qs('#m-body');
    function openModal(msg){ modalBody.textContent = msg; modal.setAttribute('aria-hidden','false'); }
    function closeModal(){ modal.setAttribute('aria-hidden','true'); }
    closeModalBtn.addEventListener('click', closeModal);
    backdrop.addEventListener('click', closeModal);
    window.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closeModal(); });

    function updateProgressUI(i){
      const total = QUESTIONS.length;
      const pct = Math.round((i/total)*100);
      barFill.style.width = pct + '%';
      count.textContent = `G√•ta ${Math.min(i+1, total)} / ${total}`;
    }

    // Gate-funktioner (f√∂rsida med kod)
    const gateUnlocked = () => localStorage.getItem(KEY_GATE) === '1';
    const setGate = (v) => localStorage.setItem(KEY_GATE, v ? '1' : '0');

    function renderGate(){
      // Uppdatera rubrik/lead
      qs('h1').textContent = 'Sp√∂krundan ‚Äì L√•s upp porten';
      qs('.lead').textContent = 'Skriv den sexsiffriga startkoden f√∂r att b√∂rja.';
      // Nollst√§ll progress
      barFill.style.width = '0%';
      count.textContent = 'Start';

      qa.innerHTML = `
        <div class="q">Skriv in startkoden (6 siffror)</div>
        <div class="field">
          <input id="gateInput" type="text" inputmode="numeric" pattern="[0-9]*" maxlength="6" autocomplete="one-time-code" placeholder="_ _ _ _ _ _" aria-label="Startkod" />
          <button id="gateBtn">L√•s upp</button>
        </div>
      `;

      const input = qs('#gateInput');
      const btn = qs('#gateBtn');
      input.focus();

      function tryUnlock(){
        const val = norm(input.value);
        if(val.length !== 6){ openModal('Koden ska vara sex siffror.'); return; }
        if(val === norm(ENTRY_CODE)){
          setGate(true);
          showToast('Porten √∂ppnas‚Ä¶');
          // √Öterst√§ll rubrik
          qs('h1').textContent = 'Sp√∂krundan ‚Äì L√•s upp n√§sta g√•ta';
          qs('.lead').textContent = 'Svara r√§tt f√∂r att komma vidare. Fel svar ger en kuslig ledtr√•d‚Ä¶ üëª';
          const startIndex = Math.min(loadProgress(), QUESTIONS.length);
          render(startIndex);
        } else {
          openModal('Fel kod. Leta vidare bland ficklamporna!');
          input.select();
        }
      }

      btn.addEventListener('click', tryUnlock);
      input.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ e.preventDefault(); tryUnlock(); }});
    }

    function render(i){
      if(i < QUESTIONS.length){ document.body.classList.remove('scare'); }
      const total = QUESTIONS.length;
      updateProgressUI(i);
      qa.innerHTML = '';

      if(i >= total){
        document.body.classList.add('scare');
        card.classList.remove('correct');
        qa.innerHTML = `
          <div class="finish" role="status" aria-live="polite">
            <div class="codeBig" aria-label="Kod">3814</div>
            <div class="codeSub">hitta skatten</div>
          </div>`;
        return;
      }

      const item = QUESTIONS[i];
      const id = `answer_${i}`;
      const hintHtml = ''; // (anv√§nder ev. ledtr√•d endast i popup)

      qa.innerHTML = `
        <div class="q" id="question" aria-live="polite">${item.q}</div>
        <div class="field">
          <input id="${id}" type="text" inputmode="text" autocomplete="off" placeholder="Skriv ditt svar h√§r‚Ä¶" aria-describedby="question" />
          <button id="submit">${SUBMIT_LABEL}</button>
        </div>
        ${hintHtml}
      `;

      const input = qs('#'+id);
      const submit = qs('#submit');
      input.focus();

      function check(){
        const val = norm(input.value);
        const correct = Array.isArray(item.answer) ? item.answer.some(a => norm(a)===val) : norm(item.answer)===val;
        if(correct){
          card.classList.add('correct');
          showToast('R√§tt svar!');
          setTimeout(()=>{
            card.classList.remove('correct');
            const next = i+1; saveProgress(next); render(next);
          }, 450);
        } else {
          openModal(item.hint ? `Fel svar. Ledtr√•d: ${item.hint}` : 'Fel svar. F√∂rs√∂k igen!');
          input.select();
        }
      }

      submit.addEventListener('click', check);
      input.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ e.preventDefault(); check(); }});
    }

    // √Öterst√§ll ‚Äì l√•ngtryck i 2 sek f√∂r att undvika misstag
    (function setupReset(){
      const btn = qs('#resetBtn');
      let t;
      const start=()=>{ t=setTimeout(()=>{ resetProgress(); renderGate(); showToast('Framsteg √•terst√§llda'); }, 2000); };
      const stop = ()=> clearTimeout(t);
      btn.addEventListener('pointerdown', start);
      btn.addEventListener('pointerup', stop);
      btn.addEventListener('pointerleave', stop);
    })();

    // Initiera
    const startIndex = Math.min(loadProgress(), QUESTIONS.length);
    if(gateUnlocked()){
      render(startIndex);
    } else {
      renderGate();
    }
  </script>
</body>
</html>
